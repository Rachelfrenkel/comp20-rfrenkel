<!DOCTYPE html>
<html>
	<head>
		<style type="text/css">
			html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
		</style>
		<script type="text/javascript"
			src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACyKO5dH-2eU_QZj5CTPv57CqvstqBXmE">
		</script>
		<script type="text/javascript">
			var xhr = new XMLHttpRequest();
			xhr.open("GET", "http://developer.mbta.com/lib/rthr/red.json", true);
			xhr.onreadystatechange = getPositions;
			xhr.send();

			function getPositions() {
				if (xhr.readyState === 4) {
					if (xhr.status === 200) {
						var posArr = [];

						var response = JSON.parse(xhr.responseText);
						var tripsArr = response["TripList"]["Trips"];

						var trainCounter = 0;
						for (var i = 0; i < tripsArr.length; i++) {
							var pos = tripsArr[i]["Position"];
							if (pos) {

								var lat = pos["Lat"];
								var lon = pos["Long"];

								posArr[trainCounter++] = {'lat':lat, 'lon':lon};
							}
						};

						initialize(posArr);

					} else {
							console.error("GOT ERROR " + xhr.statusText);
					}
				}
			};

			function initialize(posArr) {
				var mapOptions = {
					center: { lat: 42, lng: -71},
					zoom: 8
				};
				var map = new google.maps.Map(document.getElementById('map-canvas'),
						mapOptions);

				for (var i = 0; i < posArr.length; i++) {
					var marker = new google.maps.Marker({
						position: new google.maps.LatLng(posArr[i]['lat'], posArr[i]['lon']),
						map: map
					});
				}

			}

		</script>
	</head>
	<body>
<div id="map-canvas"></div>
	</body>
</html>